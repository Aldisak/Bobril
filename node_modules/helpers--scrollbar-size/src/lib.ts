import * as BrowserIdentifier from "helpers--browser-identifier";

let scrollbarSizesCache: { [zoomLevel: string]: IScrollbarSize } = {};
let scrollbarSize: IScrollbarSize | undefined = undefined;

export function getScrollbarSize(): IScrollbarSize {
    if (BrowserIdentifier.isEdge() || BrowserIdentifier.isIE()) {
        // scrollbar size in IE and Edge is independent on browser zoom level
        if (!scrollbarSize) {
            scrollbarSize = measureScrollbarSize();
        }
        return scrollbarSize;
    }
    const zoomLevel: string = Math.round(window.devicePixelRatio * 100).toString();
    if (!scrollbarSizesCache[zoomLevel]) {
        scrollbarSizesCache[zoomLevel] = measureScrollbarSize();
    }
    return scrollbarSizesCache[zoomLevel];
}

function measureScrollbarSize(): IScrollbarSize {
    let scrollDiv = document.createElement("div");
    scrollDiv.style.width = "200px";
    scrollDiv.style.height = "200px";
    scrollDiv.style.overflow = "scroll";
    scrollDiv.style.position = "absolute";
    scrollDiv.style.top = "-9999px";
    scrollDiv.style.visibility = "hidden";
    document.body.appendChild(scrollDiv);

    let offsetWidth = scrollDiv.offsetWidth;
    let clientWidth = scrollDiv.clientWidth;
    let offsetHeight = scrollDiv.offsetHeight;
    let clientHeight = scrollDiv.clientHeight;
    document.body.removeChild(scrollDiv);

    return {
        vertical: offsetWidth - clientWidth,
        horizontal: offsetHeight - clientHeight
    };
}

export interface IScrollbarSize {
    vertical: number;
    horizontal: number;
}
