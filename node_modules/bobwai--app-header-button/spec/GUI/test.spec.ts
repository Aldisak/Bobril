import { BBBot, BBSeeker } from "bbseeker-extended";
import { createLayout } from "./layout";
import { getTestStore, clearTestStore } from "./store";
import { Selectors } from "../../src/testSelectors";

describe("AppHeaderButton UI tests", () => {
    afterEach(() => {
        //BBBot.clear();
        clearTestStore();
    });

    it("should be possible click multiple times on buttons by mouse", async () => {
        createLayout();
        const bot = BBBot.createBot();

        if (await BBBot.checkIfFullyRendered(4)) {
            const buttons = BBSeeker.findElements(Selectors.id);
            for (let i = 0; i < buttons.length; i++) {
                await bot.emitLeftMouseClickOnHTMLElement(buttons[i]);
                expect(getTestStore().buttonCounter[i]).toBe(i === buttons.length - 1 ? 0 : 1);
            }
        } else {
            fail("Test failed due it is not fully rendered");
        }
    });
    it("should be possible click multiple times on buttons by Enter", async () => {
        createLayout();
        const bot = BBBot.createBot();

        if (await BBBot.checkIfFullyRendered(4)) {
            const buttons = BBSeeker.findElements(Selectors.id);
            await bot.emitKeyPress(BBBot.KeyCodes.Tab);

            for (let i = 0; i < buttons.length; i++) {
                await bot.emitKeyPress(BBBot.KeyCodes.Enter);
                expect(getTestStore().buttonCounter[i]).toBe(i === buttons.length - 1 ? 0 : 1);

                await bot.emitKeyPress(BBBot.KeyCodes.Tab);
            }
        } else {
            fail("Test failed due it is not fully rendered");
        }
    });
    it("should be possible click multiple times on buttons by Spacebar", async () => {
        createLayout();
        const bot = BBBot.createBot();

        if (await BBBot.checkIfFullyRendered(4)) {
            const buttons = BBSeeker.findElements(Selectors.id);
            await bot.emitKeyPress(BBBot.KeyCodes.Tab);

            for (let i = 0; i < buttons.length; i++) {
                await bot.emitKeyPress(BBBot.KeyCodes.Spacebar);
                expect(getTestStore().buttonCounter[i]).toBe(i === buttons.length - 1 ? 0 : 1);

                await bot.emitKeyPress(BBBot.KeyCodes.Tab);
            }
        } else {
            fail("Test failed due it is not fully rendered");
        }
    });
    it("should call onMouseEnter callback", async () => {
        createLayout();
        const bot = BBBot.createBot();

        if (await BBBot.checkIfFullyRendered(4)) {
            const buttons = BBSeeker.findElements(Selectors.id);
            await bot.pointerMoveToElm(buttons[0]);
            expect(getTestStore().onEnterCount).toBe(1);
        } else {
            fail("Test failed due it is not fully rendered");
        }
    });
});
